setwd("D:/R/MRIReport")

####LIBRARIES####
library(psych)
library(ggplot2)
library(dplyr)
library(table1)
library(patchwork)
library(rstatix)
library(tibble)
library(readr)
library(tidyverse)
library(ggpubr)

####DATA IMPORT####
df <- read_csv("MRIreport_df.csv", 
                col_types = cols(
                  NAME = col_skip(), 
                  `SEX (m/f)` = col_factor(
                    levels = c("f","m")
                    ), 
                  `DOB (dd/mm/yyyy)` = col_skip(),
                  `DOE (dd/mm/yyyy)` = col_skip(),
                  `GROUP (1 - control, 2 - MCI, 3 - other)` = col_factor(
                    levels = c("1","2", "3")
                    ), 
                  `MMSE (0-30)` = col_double(),
                  GWR = col_skip(), RSFMRI = col_skip(),
                  `DIFF 1` = col_skip(), `DIFF 2` = col_skip(),
                  `DIFF 3` = col_skip(), `DIFF 4` = col_skip(),
                  `DIFF ?` = col_skip()
                  )
               )
View(df)
colnames(df) <- c("N", "SEX", "AGE", "GROUP", "MMSE", 
           "MOCA_T", "MOCA_VS", "MOCA_N", "MOCA_At", "MOCA_C", 
           "MOCA_S", "MOCA_Ab", "MOCA_M", "MOCA_O", "GCA",
           "WML", "MTA", "PA", "FA", "MRSA1",
           "MRSA2", "MRSA3", "MRSA4", "MRSA5", "MRSA6",
           "MRSR1", "MRSR2", "MRSR3", "MRSR4", "MRSR5",
           "CBF")

####DESCRIPTIVE STATS####
describe(df, fast=F)
Descr_stat <- describeBy(df, group = 'GROUP (1 - control, 2 - MCI, 3 - other)', fast=T)
descr_stat_1 <- Descr_stat$'1'
descr_stat_2 <- Descr_stat$'2'
descr_stat_3 <- Descr_stat$'3'

####VISUALIZING####
plot(descr_stat_1[c(15:19),3])

##Boxplots for mri scales with counts
p1 <- ggplot(na.omit(df[,c("WML","GROUP")]), aes(WML, fill=GROUP))+
  geom_bar(position="dodge")+
  bgcolor("#FFFFFF")+ 
  grids(linetype = "dashed")+
  scale_fill_grey()
ggpar(p1, main = "???????????????????? ?????????? ?????????????????? ???????????? ???????????????? ?????????? ???????????????????? ??????????",
      xlab = "???????? ???? Fazekas", 
      ylab = "?????????? ??????????????????",
      legend.title = "????????????",
      )
p2 <- ggplot(na.omit(df[,c("MTA","GROUP")]), aes(MTA, fill=GROUP))+
  geom_bar(position="dodge")+
  bgcolor("#FFFFFF")+ 
  grids(linetype = "dashed")+
  scale_fill_grey()
ggpar(p2, main = "???????????????????? ?????????? ???????????????? ?????????????? ?????????? ???????????????????? ??????????",
      xlab = "???????? ???? Scheltens", 
      ylab = "?????????? ??????????????????",
      legend.title = "????????????"
      )
p3 <- ggplot(na.omit(df[,c("PA","GROUP")]), aes(PA, fill=GROUP))+
  geom_bar(position="dodge")+
  bgcolor("#FFFFFF")+ 
  grids(linetype = "dashed")+
  scale_fill_grey()
ggpar(p3, main = "???????????????????? ?????????? ???????????????? ?????????????? ?????????? ???????????????????? ??????????",
      xlab = "???????? ???? Koedam", 
      ylab = "?????????? ??????????????????",
      legend.title = "????????????",
)
p4 <- ggplot(na.omit(df[,c("FA","GROUP")]), aes(FA, fill=GROUP))+
  geom_bar(position="dodge")+
  bgcolor("#FFFFFF")+ 
  grids(linetype = "dashed")+
  scale_fill_grey()
ggpar(p4, main = "???????????????????? ?????????? ???????????? ?????????????? ?????????? ???????????????????? ??????????",
      xlab = "???????? ???? FA", 
      ylab = "?????????? ??????????????????",
      legend.title = "????????????"
)

##Boxplots for mri scales with %
p11 <- ggplot(na.omit(df[,c("WML","GROUP")]), aes(WML, fill=GROUP))+
  geom_bar(position="fill")+
  bgcolor("#FFFFFF")+ 
  grids(linetype = "dashed")+
  scale_fill_grey()
ggpar(p11, main = "???????????????????? ?????????? ?????????????????? ???????????? ???????????????? ?????????? ???????????????????? ??????????",
      xlab = "???????? ???? Fazekas", 
      ylab = "???????? ??????????????????",
      legend.title = "????????????",
)
p21 <- ggplot(na.omit(df[,c("MTA","GROUP")]), aes(MTA, fill=GROUP))+
  geom_bar(position="fill")+
  bgcolor("#FFFFFF")+ 
  grids(linetype = "dashed")+
  scale_fill_grey()
ggpar(p21, main = "???????????????????? ?????????? ???????????????? ?????????????? ?????????? ???????????????????? ??????????",
      xlab = "???????? ???? Scheltens", 
      ylab = "???????? ??????????????????",
      legend.title = "????????????"
)
p31 <- ggplot(na.omit(df[,c("PA","GROUP")]), aes(PA, fill=GROUP))+
  geom_bar(position="fill")+
  bgcolor("#FFFFFF")+ 
  grids(linetype = "dashed")+
  scale_fill_grey()
ggpar(p31, main = "???????????????????? ?????????? ???????????????? ?????????????? ?????????? ???????????????????? ??????????",
      xlab = "???????? ???? Koedam", 
      ylab = "???????? ??????????????????",
      legend.title = "????????????",
)
p41 <- ggplot(na.omit(df[,c("FA","GROUP")]), aes(FA, fill=GROUP))+
  geom_bar(position="fill")+
  bgcolor("#FFFFFF")+ 
  grids(linetype = "dashed")+
  scale_fill_grey()
ggpar(p41, main = "???????????????????? ?????????? ???????????? ?????????????? ?????????? ???????????????????? ??????????",
      xlab = "???????? ???? FA", 
      ylab = "???????? ??????????????????",
      legend.title = "????????????"
)


####HYPOTHESES TESTING####
tb <- as_tibble(df)
test.AGE <- tb %>% 
  wilcox_test(AGE ~ GROUP) %>%
  add_significance()
test.MMSE <- tb %>% 
  wilcox_test(MMSE ~ GROUP) %>%
  add_significance()
test.MOCA <- tb %>% 
  wilcox_test(MOCA_T ~ GROUP) %>%
  add_significance()
test.GCA <- tb %>% 
  wilcox_test(GCA ~ GROUP) %>%
  add_significance()
test.WML <- tb %>% 
  wilcox_test(WML ~ GROUP) %>%
  add_significance()
test.MTA <- tb %>% 
  wilcox_test(MTA ~ GROUP) %>%
  add_significance()
test.PA <- tb %>% 
  wilcox_test(PA ~ GROUP) %>%
  add_significance()
test.FA <- tb %>% 
  wilcox_test(FA ~ GROUP) %>%
  add_significance()
test.MRSA1 <- tb %>% 
  wilcox_test(MRSA1 ~ GROUP) %>%
  add_significance()
test.MRSA2 <- tb %>% 
  wilcox_test(MRSA2 ~ GROUP) %>%
  add_significance()
test.MRSA3 <- tb %>% 
  wilcox_test(MRSA3 ~ GROUP) %>%
  add_significance()
test.MRSA4 <- tb %>% 
  wilcox_test(MRSA4 ~ GROUP) %>%
  add_significance()
test.MRSA5 <- tb %>% 
  wilcox_test(MRSA5 ~ GROUP) %>%
  add_significance()
test.MRSA6 <- tb %>% 
  wilcox_test(MRSA6 ~ GROUP) %>%
  add_significance()
test.MRSR1 <- tb %>% 
  wilcox_test(MRSR1 ~ GROUP) %>%
  add_significance()
test.MRSR2 <- tb %>% 
  wilcox_test(MRSR2 ~ GROUP) %>%
  add_significance()
test.MRSR3 <- tb %>% 
  wilcox_test(MRSR3 ~ GROUP) %>%
  add_significance()
test.MRSR4 <- tb %>% 
  wilcox_test(MRSR4 ~ GROUP) %>%
  add_significance()
test.MRSR5 <- tb %>% 
  wilcox_test(MRSR5 ~ GROUP) %>%
  add_significance()
test.CBF <- tb %>% 
  wilcox_test(CBF ~ GROUP) %>%
  add_significance()

####EXPORT TABLES####
table1::table1(~SEX + AGE + MMSE + MOCA_T  | GROUP, 
               data = df, na.rm = TRUE, digits = 2, format.number = TRUE)
table1::table1(~GCA + WML + MTA + PA + FA  | GROUP, 
               data = df, na.rm = TRUE, digits = 2, format.number = TRUE)
table1::table1(~MRSA1 + MRSA2 + MRSA3 + MRSA4 + MRSA5 + MRSA6  | GROUP, 
               data = df, na.rm = TRUE, digits = 3, format.number = TRUE)
table1::table1(~MRSR1 + MRSR2 + MRSR3 + MRSR4 + MRSR5  | GROUP, 
               data = df, na.rm = TRUE, digits = 3, format.number = TRUE)
table1::table1(~CBF  | GROUP, 
               data = df, na.rm = TRUE, digits = 2, format.number = TRUE)